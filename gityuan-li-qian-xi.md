# Git原理浅析

让我们自己来设计版本管理工具，无外乎如下两块：

> 工作区 -> 远程仓库

但如果支持分布式，需要添加一个本地仓库。即

> 工作区 -> 本地仓库 -> 远程仓库

同时，为了支持能够实现部分提交，且不在工作区创建状态问题件污染工作区、满足暂存记录文件的信息等需要，我们需要在工作区与本地仓库之间增加一个暂存区，即：

> 工作区 -> 暂存区 -> 本地仓库 -> 远程仓库

这就是Git设计的基本骨架了。

## 快照

首先，你可能会问，本地仓库在哪？

我们使用命令`git init`或`git clone`等就会创建本地仓库（Repository），即工作区目录下的`.git`文件夹。

我们再来看下什么是快照？

![](/assets/snapshot-version-01.png)

这是项目的三个版本，版本1中有两个文件A和B，然后修改了A，变成了A1，形成了版本2，接着又修改了B变为B1，形成了版本3。

如果我们把项目的每个版本都保存到本地仓库，需要保存至少6个文件，而实际上，只有4个不同的文件，A、A1、B、B1。为了节省存储的空间，我们要像一个方法将同样的文件只需要保存一份。这就引入了[Sha-1算法](https://en.wikipedia.org/wiki/SHA-1)。

可以使用git命令计算文件的 sha-1 值。

```bash
echo 'test content' | git hash-object --stdin
d670460b4b4aece5915caf5c68d12f560a9fe3e4
```

